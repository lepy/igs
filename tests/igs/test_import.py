# -*- coding: utf-8 -*-

import os
import sys
import numpy as np

if sys.version_info[0] < 3:
    from StringIO import StringIO
else:
    from io import StringIO

import igs.igs

modulepath = os.path.dirname(__file__)


s = """                                                                        S0000001
,,31HOpen CASCADE IGES processor 6.8,13HFilename.iges,                  G0000001
16HOpen CASCADE 6.8,31HOpen CASCADE IGES processor 6.8,32,308,15,308,15,G0000002
,1.,2,2HMM,1,0.01,15H20180114.122329,1E-07,11.510691,,,11,0,            G0000003
15H20180114.122329,;                                                    G0000004
     402       1       0       0       0       0       0       000000000D0000001
     402       0       0       1       1                               0D0000002
     144       2       0       0       0       0       0       000020000D0000003
     144       0       0       1       0                               0D0000004
     108       3       0       0       0       0       0       000010000D0000005
     108       0       0       1       0                               0D0000006
     142       4       0       0       0       0       0       000010500D0000007
     142       0       0       1       0                               0D0000008
     102       5       0       0       0       0       0       000010000D0000009
     102       0       0       1       0                               0D0000010
     110       6       0       0       0       0       0       000010000D0000011
     110       0       0       1       0                               0D0000012
     110       7       0       0       0       0       0       000010000D0000013
     110       0       0       1       0                               0D0000014
     110       8       0       0       0       0       0       000010000D0000015
     110       0       0       1       0                               0D0000016
     110       9       0       0       0       0       0       000010000D0000017
     110       0       0       1       0                               0D0000018
     144      10       0       0       0       0       0       000020000D0000019
     144       0       0       1       0                               0D0000020
     108      11       0       0       0       0       0       000010000D0000021
     108       0       0       1       0                               0D0000022
     142      12       0       0       0       0       0       000010500D0000023
     142       0       0       1       0                               0D0000024
     102      13       0       0       0       0       0       000010000D0000025
     102       0       0       1       0                               0D0000026
     110      14       0       0       0       0       0       000010000D0000027
     110       0       0       1       0                               0D0000028
     110      15       0       0       0       0       0       000010000D0000029
     110       0       0       1       0                               0D0000030
     110      16       0       0       0       0       0       000010000D0000031
     110       0       0       1       0                               0D0000032
402,2,3,19;                                                      0000001P0000001
144,5,1,0,7;                                                     0000003P0000002
108,0.,0.,-1.,0.,0,4.550729124,-0.744933762,0.,0.;               0000005P0000003
142,0,5,0,9,2;                                                   0000007P0000004
102,4,11,13,15,17;                                               0000009P0000005
110,4.550729124,-0.744933762,0.,7.323911066,1.835075705,1.;      0000011P0000006
110,7.323911066,1.835075705,0.,10.105619833,-2.675265688,0.;     0000013P0000007
110,10.105619833,-2.675265688,0.,5.242880018,-5.702914677,0.;    0000015P0000008
110,5.242880018,-5.702914677,0.,4.550729124,-0.744933762,0.;     0000017P0000009
144,21,1,0,23;                                                   0000019P0000010
108,0.,0.,1.,0.,0,7.323911066,1.835075705,0.,0.;                 0000021P0000011
142,0,21,0,25,2;                                                 0000023P0000012
102,3,27,29,31;                                                  0000025P0000013
110,7.323911066,1.835075705,0.,10.105619431,-2.675265789,0.;     0000027P0000014
110,10.105619431,-2.675265789,0.,11.510690799,0.854641465,0.;    0000029P0000015
110,11.510690799,0.854641465,0.,7.323911066,1.835075705,0.;      0000031P0000016
S      1G      4D     32P     16                                        T0000001
"""

def test_import():

    filepath = os.path.join(modulepath, "test001.iges")

    iges = igs.igs.Iges(open(filepath, "r"))
    print(iges.entries.head())
    assert len(iges.entries)==1049
    print(iges.info())

def test_type_110():
    fh = StringIO(s)
    iges = igs.igs.Iges(fh)
    df110 = iges.get_type_df(110)
    print(df110.head())
    print(df110.columns)
    print(len(df110))
    assert len(df110)==7
    print(df110.iloc[0].tolist())
    assert np.allclose(df110.iloc[0][['x1', 'y1', 'z1', 'x2', 'y2', 'z2']], [4.550729124, -0.744933762, 0.0, 7.323911066, 1.835075705, 1.0])


if __name__ == '__main__':
    test_import()
    test_type_110()
